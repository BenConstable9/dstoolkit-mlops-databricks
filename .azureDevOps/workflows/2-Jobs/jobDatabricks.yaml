###################################################################################################################################################################//
##                                                                      JOBS                                
###################################################################################################################################################################//

parameters: 
  Environment:                                String
  azureSubscription:                          String
  enableRepoPull:                             Boolean
  branchName:                                 String
  updateFolder:                               String


jobs:                  
  - deployment:                               ${{ parameters.Environment }}
    displayName:                              ${{ parameters.Environment }}
    variables:
      - template:                             ..\Variables\${{ parameters.Environment }}\core.yaml
    environment:                              ${{ parameters.Environment }}
    strategy:
      runOnce:
        deploy:
          steps:
          - checkout:                         self
            fetchDepth:                       2
            #ref:                              ${{ parameters.branchName }}
            # Paramount for fetchDepth to 2 for Git File Changes Check

          - template:                         ../3-Tasks/taskDatabricks.yaml
            parameters:
              SubscriptionId:                 ${{ variables.SubscriptionId }}
              Location:                       ${{ variables.Location }}
              TemplateFilePath:               ${{ variables.TemplateFilePath }}     
              TemplateParamFilePath:          ${{ variables.TemplateParamFilePath }}    
              MANAGEMENT_RESOURCE_ENDPOINT:   ${{ variables.MANAGEMENT_RESOURCE_ENDPOINT }}
              AZURE_DATABRICKS_APP_ID:        ${{ variables.AZURE_DATABRICKS_APP_ID }}
              azureSubscription:              ${{ parameters.azureSubscription }}
              Environment:                    ${{ parameters.Environment }}
              enableRepoPull:                 ${{ parameters.enableRepoPull }}
              branchName:                     ${{ parameters.branchName }}
              updateFolder:                   ${{ parameters.updateFolder }}
